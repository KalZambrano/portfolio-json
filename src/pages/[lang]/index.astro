---
import App from "@/components/App.astro";
import { LANGUAGES } from "@/config/languages";

export async function getStaticPaths() {
  const paths = [];
  
  for (const [key, lang] of Object.entries(LANGUAGES)) {
    try {
      // Dynamic import based on language key
      const cvData = await import(`../../../cv_${key}.json`).then(m => m.default);
      
      paths.push({
        params: { lang: key },
        props: { 
          lang: key,
          cv: cvData
        },
      });
    } catch (error) {
      console.warn(`Skipping language ${key}: CV file not found or invalid`);
      // Skip this language if the file doesn't exist
      continue;
    }
  }

  // Ensure we have at least one language (fallback to Spanish if needed)
  if (paths.length === 0) {
    console.error('No valid language files found. Using Spanish as fallback.');
    const cvData = await import('../../../cv_es.json').then(m => m.default);
    paths.push({
      params: { lang: 'es' },
      props: {
        lang: 'es',
        cv: cvData
      }
    });
  }

  return paths;
}

const { cv } = Astro.props;
---

<App cv={cv} />